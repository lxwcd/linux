# 域名无法解析
- Ubuntu 22.04 
  
1. ping 内网主机 IP 能通信
2. ping 外网主机 IP 能通信
3. ping 外围网址，如 `www.baidu.com` 无法通信
```bash
[root@Web2 netplan]$ ping www.baidu.com
ping: www.baidu.com: Temporary failure in name resolution
[root@Web2 netplan]$ ping 220.181.38.150
PING 220.181.38.150 (220.181.38.150) 56(84) bytes of data.
64 bytes from 220.181.38.150: icmp_seq=1 ttl=128 time=9.23 ms
64 bytes from 220.181.38.150: icmp_seq=2 ttl=128 time=6.41 ms
^C
--- 220.181.38.150 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 6.410/7.819/9.229/1.409 ms
```
4. 查看 `/etc/resolv.conf` 文件
```bash
[root@Web2 netplan]$ cat /etc/resolv.conf
# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad
search .
```
5. resolvectl status 查看
```bash
[root@Web2 netplan]$ resolvectl status
Global
       Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
resolv.conf mode: stub

Link 2 (eth0)
Current Scopes: none
     Protocols: -DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
```

```bash
[root@Web2 netplan]$ systemctl status systemd-resolved.service
● systemd-resolved.service - Network Name Resolution
     Loaded: loaded (/lib/systemd/system/systemd-resolved.service; enabled; vendor preset: enabled)
     Active: active (running) since Sun 2023-05-14 09:22:54 CST; 2h 56min ago
       Docs: man:systemd-resolved.service(8)
             man:org.freedesktop.resolve1(5)
             https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers
             https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients
   Main PID: 792 (systemd-resolve)
     Status: "Processing requests..."
      Tasks: 1 (limit: 2193)
     Memory: 8.6M
        CPU: 2.112s
     CGroup: /system.slice/systemd-resolved.service
             └─792 /lib/systemd/systemd-resolved

May 14 09:22:54 ubuntu22-c4 systemd[1]: Starting Network Name Resolution...
May 14 09:22:54 ubuntu22-c4 systemd-resolved[792]: Positive Trust Anchors:
May 14 09:22:54 ubuntu22-c4 systemd-resolved[792]: . IN DS 20326 8 2 e06d44b80b8f1d39a95c0b0d7c65d08458e880409bb>
May 14 09:22:54 ubuntu22-c4 systemd-resolved[792]: Negative trust anchors: home.arpa 10.in-addr.arpa 16.172.in-a>
May 14 09:22:54 ubuntu22-c4 systemd-resolved[792]: Using system hostname 'ubuntu22-c4'.
May 14 09:22:54 ubuntu22-c4 systemd[1]: Started Network Name Resolution.
May 14 11:08:39 Web2 systemd-resolved[792]: System hostname changed to 'Web2'.
```

6. 网卡配置文件添加 DNS 服务器
添加完成后 `netplan apply` 生效
```bash
1   # This file describes the network interfaces available on your system
  1 # For more information, see netplan(5).
  2 network:
  3   version: 2
  4  #renderer: networkd
  5   renderer: NetworkManager
  6   ethernets:
  7     eth0:
  8       match:
  9         name: eth0
 10       addresses:
 11       - 10.0.0.204/24
 12      #gateway4: 10.0.0.2
 13       routes:
 14       - to: default
 15         via: 10.0.0.2
 16       nameservers:
 17         addresses: [10.0.0.2]
```

- 查看效果
```bash
[root@Web2 netplan]$ cat /etc/resolv.conf
# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad
search .
```
```bash
[root@Web2 netplan]$ resolvectl status
Global
       Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
resolv.conf mode: stub

Link 2 (eth0)
    Current Scopes: DNS
         Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Current DNS Server: 10.0.0.2
       DNS Servers: 10.0.0.2
```
```bash
[root@Web2 netplan]$ ping www.baidu.com
PING www.baidu.com (220.181.38.150) 56(84) bytes of data.
64 bytes from 220.181.38.150 (220.181.38.150): icmp_seq=1 ttl=128 time=3.89 ms
64 bytes from 220.181.38.150 (220.181.38.150): icmp_seq=2 ttl=128 time=4.30 ms
^C
--- www.baidu.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 3.890/4.094/4.298/0.204 ms
```